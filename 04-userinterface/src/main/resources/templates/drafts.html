<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>RailPlan - Draft</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
    <h1>RailPlan</h1>
    <h2>Rail Network Drafts</h2>
    <ul>
        <li th:each="draftId,status : ${draftIds}">
            <span th:if="${currentDraftId == draftId}">*</span>
            <a th:href="@{|/drafts/${draftId}|}" th:text="'Draft ' + ${status.count}">Draft 1</a>
            (<a th:href="@{|/drafts/${draftId}/delete|}">Delete</a>)
        </li>
    </ul>
    <div>
        <a href="/drafts/new">New Draft</a>
    </div>
    <div th:if="${currentDraftDto != null}">
        <h3>Stations</h3>
        <form method="post">
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Latitude</th>
                        <th>Longitude</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="row, status : ${stationTableRows}">
                        <td th:text="${status.count}">1</td>
                        <td th:insert="::stationTableCell('stationName', ${row.stationName}, ${row.showInputField}, ${row.stationNameErrors})"></td>
                        <td th:insert="::stationTableCell('latitude', ${row.latitude}, ${row.showInputField}, ${row.latitudeErrors})"></td>
                        <td th:insert="::stationTableCell('longitude', ${row.longitude}, ${row.showInputField}, ${row.longitudeErrors})"></td>
                        <td>
                            <div th:unless="${row.showInputField}">
                                <a th:href="@{|/drafts/${currentDraftId}/stations/${row.stationId}/edit|}">Edit</a> |
                                <a th:href="@{|/drafts/${currentDraftId}/stations/${row.stationId}/delete|}">Delete</a>
                            </div>
                            <div th:if="${row.showInputField}">
                                <input type="submit" value="Update"> |
                                <a th:href="@{|/drafts/${currentDraftId}|}">Cancel</a>
                            </div>
                        </td>
                    </tr>
                    <tr th:unless="${showNewStationForm}">
                        <td colspan="4"><a th:href="@{|/drafts/${currentDraftId}/stations/new|}">+ Add Station</a></td>
                    </tr>
                    <tr th:if="${showNewStationForm}">
                        <td>+</td>
                        <td th:insert="::stationTableCell('stationName', ${newStationTableRow.stationName}, ${newStationTableRow.showInputField}, ${newStationTableRow.stationNameErrors})"></td>
                        <td th:insert="::stationTableCell('latitude', ${newStationTableRow.latitude}, ${newStationTableRow.showInputField}, ${newStationTableRow.latitudeErrors})"></td>
                        <td th:insert="::stationTableCell('longitude', ${newStationTableRow.longitude}, ${newStationTableRow.showInputField}, ${newStationTableRow.longitudeErrors})"></td>
                        <td>
                            <div>
                                <input type="submit" value="Add Station"> |
                                <a th:href="@{|/drafts/${currentDraftId}|}">Cancel</a>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div th:fragment="stationTableCell(name, value, showInputField, errors)">
                <span th:if="not ${showInputField}" th:text="${value}"></span>
                <input th:if="${showInputField}" type="text" th:name="${name}" th:value="${value}">
                <ul th:if="${showInputField == true and not #lists.isEmpty(errors)}">
                    <li th:each="error : ${errors}" th:text="${error}">Error</li>
                </ul>
            </div>
        </form>

        <h3>Tracks</h3>
        <form action="#" th:action="@{|/drafts/${currentDraftId}/tracks/new|}" th:object="${newTrack}" method="post">
            <table>
                <tbody>
                    <tr th:each="track,status : ${tracks}">
                        <td th:text="${status.count}">1</td>
                        <td th:text="${track.get(0).getValue1()}">Berlin Hbf</td>
                        <td>&lt;&equals;&gt;</td>
                        <td th:text="${track.get(1).getValue1()}">Hamburg Hbf</td>
                        <td><a th:href="@{|/drafts/${currentDraftId}/tracks/${track.get(0).getValue0()}/${track.get(1).getValue0()}/delete|}">Delete</a></td>
                    </tr>
                    <tr>
                        <td>+</td>
                        <td>
                            <select th:field="*{firstStationId}">
                                <option th:each="name : ${stationNames}" th:value="${name.getKey()}" th:text="${name.getValue()}">Berlin Hbf</option>
                            </select>
                        </td>
                        <td>&lt;&equals;&gt;</td>
                        <td>
                            <select th:field="*{secondStationId}">
                                <option th:each="name : ${stationNames}" th:value="${name.getKey()}" th:text="${name.getValue()}">Hamburg Hbf</option>
                            </select>
                        </td>
                        <td><input type="submit" value="Add Track"></td>
                    </tr>
                    <tr th:if="${trackErrors != null}">
                        <td></td>
                        <td>
                            <ul th:if="${trackErrors['First Station ID'] != null}">
                                <li th:each="firstStationError : ${trackErrors['First Station ID']}" th:text="${firstStationError}">First Station Error</li>
                            </ul>
                        </td>
                        <td></td>
                        <td>
                            <ul th:if="${trackErrors['Second Station ID'] != null}">
                                <li th:each="secondStationError : ${trackErrors['Second Station ID']}" th:text="${secondStationError}">Second Station Error</li>
                            </ul>
                        </td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </form>
    </div>

</body>
</html>
